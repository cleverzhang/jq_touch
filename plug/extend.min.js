(function(b){var c=function(d){var f="touchstart touchmove touchend".split(" ");d=d.originalEvent||d;if(b.inArray(d.type,f)){return{x:d.targetTouches[0].pageX,y:d.targetTouches[0].pageY}}else{return{x:d.pageX,y:d.pageY}}};var a=function(g,l){var j=b("<span>").html(b("#"+g).html());var q=j.html();var f;var e={},m={};var h=[new RegExp("{#\\s*.+\\s*#}","img")];var r=function(s){return new RegExp("{#\\s*"+s+"\\s*#}","igm")};var i=function(s){return new RegExp("<foreach\\s+id=['\\\"]"+s+"['\\\"]>[\\s\\S]*?<\\/foreach>","igm")};var n=function(t,s){return new RegExp("{#\\s*"+t+"\\s*\\[\\s*"+s+"\\s*\\]\\s*#}","igm")};var k=function(){for(var s in m){f=r(s);q=q.replace(f,l[s])}j=b("<span>").html(q);b("var",j).each(function(){var t=b(this);var x=t.attr("name");try{var w=m[x];if(w){t.replaceWith(w)}else{var u=t.attr("default");if(u){t.replaceWith(u)}else{t.remove()}}}catch(v){t.remove()}});q=j.html()};var o=function(){for(var t in e){var s="";var u=b("#"+t,j);if(u.length){e[t].forEach(function(w){var x=u.html();for(var v in w){f=n(t,v);x=x.replace(f,w[v])}s+=x})}b("foreach[id='"+t+"']",j).replaceWith(s);q=j.html()}};var p=function(){b("if",j).each(function(){var t=b(this);var v=t.attr("condition");try{var s=eval(v);if(s){t.replaceWith(t.html())}else{t.remove()}}catch(u){t.remove()}});q=j.html()};if(b.isPlainObject(l)){for(var d in l){if(b.isArray(l[d])){e[d]=l[d]}else{m[d]=l[d]}}k();o();p()}b("if,var,foreach",j).each(function(){b(this).remove()});q=j.html();b.each(h,function(s){q=q.replace(h[s],"")});f=new RegExp("t_src","img");q=q.replace(f,"src");delete j;return q};b.extend({"touchPosition":c,"templateRender":a})})($);